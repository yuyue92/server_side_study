<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººåšå®¢ç³»ç»Ÿ - å®Œæ•´æµ‹è¯•ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 28px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-small {
            padding: 5px 12px;
            font-size: 12px;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            min-height: 500px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }

        .nav-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #6c757d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .alert.show {
            display: flex;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .post-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .post-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .post-card h3 {
            color: #333;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .post-card h3:hover {
            color: #667eea;
        }

        .post-meta {
            color: #6c757d;
            font-size: 13px;
            margin-bottom: 15px;
        }

        .post-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .post-actions {
            display: flex;
            gap: 10px;
        }

        .comment-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .comment-meta {
            color: #6c757d;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .comment-content {
            color: #333;
            line-height: 1.6;
        }

        .back-btn {
            margin-bottom: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .config-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .test-item {
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 4px;
            font-size: 13px;
        }

        .test-success {
            background: #d4edda;
            color: #155724;
        }

        .test-error {
            background: #f8d7da;
            color: #721c24;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .post-actions {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ä¸ªäººåšå®¢ç³»ç»Ÿ</h1>
            <div class="user-info">
                <span id="userDisplay"></span>
                <button id="logoutBtn" class="btn btn-secondary btn-small hidden">é€€å‡ºç™»å½•</button>
            </div>
        </div>

        <div id="alertBox" class="alert"></div>

        <div class="content">
            <div class="nav-tabs">
                <button class="nav-tab active" data-page="home">é¦–é¡µ</button>
                <button class="nav-tab" data-page="login">ç™»å½•</button>
                <button class="nav-tab" data-page="register">æ³¨å†Œ</button>
                <button class="nav-tab" data-page="myPosts">æˆ‘çš„æ–‡ç« </button>
                <button class="nav-tab" data-page="createPost">å‘å¸ƒæ–‡ç« </button>
                <button class="nav-tab" data-page="test">APIæµ‹è¯•</button>
            </div>

            <div id="homePage" class="page">
                <h2 style="margin-bottom: 20px;">ğŸ“š æœ€æ–°æ–‡ç« </h2>
                <div id="postsList"></div>
            </div>

            <div id="loginPage" class="page hidden">
                <h2 style="margin-bottom: 20px;">ğŸ” ç”¨æˆ·ç™»å½•</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input type="text" id="loginUsername" required>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary">ç™»å½•</button>
                </form>
            </div>

            <div id="registerPage" class="page hidden">
                <h2 style="margin-bottom: 20px;">ğŸ“ ç”¨æˆ·æ³¨å†Œ</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input type="text" id="regUsername" required>
                    </div>
                    <div class="form-group">
                        <label>é‚®ç®±</label>
                        <input type="email" id="regEmail" required>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" id="regPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary">æ³¨å†Œ</button>
                </form>
            </div>

            <div id="myPostsPage" class="page hidden">
                <h2 style="margin-bottom: 20px;">ğŸ“– æˆ‘çš„æ–‡ç« </h2>
                <div id="myPostsList"></div>
            </div>

            <div id="createPostPage" class="page hidden">
                <h2 style="margin-bottom: 20px;">âœï¸ å‘å¸ƒæ–‡ç« </h2>
                <form id="createPostForm">
                    <div class="form-group">
                        <label>æ ‡é¢˜</label>
                        <input type="text" id="postTitle" required>
                    </div>
                    <div class="form-group">
                        <label>å†…å®¹</label>
                        <textarea id="postContent" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">å‘å¸ƒ</button>
                </form>
            </div>

            <div id="postDetailPage" class="page hidden">
                <button class="btn btn-secondary back-btn" onclick="app.showPage('home')">â† è¿”å›</button>
                <div id="postDetail"></div>
                <div id="commentsSection" style="margin-top: 40px;">
                    <h3 style="margin-bottom: 20px;">ğŸ’¬ è¯„è®ºåŒº</h3>
                    <form id="commentForm" class="hidden" style="margin-bottom: 30px;">
                        <div class="form-group">
                            <textarea id="commentContent" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">å‘è¡¨è¯„è®º</button>
                    </form>
                    <div id="commentsList"></div>
                </div>
            </div>

            <div id="editPostPage" class="page hidden">
                <button class="btn btn-secondary back-btn" onclick="app.showPage('myPosts')">â† è¿”å›</button>
                <h2 style="margin-bottom: 20px;">âœï¸ ç¼–è¾‘æ–‡ç« </h2>
                <form id="editPostForm">
                    <input type="hidden" id="editPostId">
                    <div class="form-group">
                        <label>æ ‡é¢˜</label>
                        <input type="text" id="editPostTitle" required>
                    </div>
                    <div class="form-group">
                        <label>å†…å®¹</label>
                        <textarea id="editPostContent" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                </form>
            </div>

            <div id="testPage" class="page hidden">
                <h2 style="margin-bottom: 20px;">ğŸ§ª APIæµ‹è¯•ä¸­å¿ƒ</h2>

                <div class="config-section">
                    <h3>âš™ï¸ é…ç½®</h3>
                    <div class="form-group">
                        <label>API Base URL</label>
                        <input type="text" id="apiBaseUrl" value="http://localhost:8080/api/v1">
                    </div>
                    <button class="btn btn-primary" onclick="app.saveConfig()">ä¿å­˜é…ç½®</button>
                </div>

                <div class="config-section">
                    <h3>ğŸ” æµ‹è¯•é€‰é¡¹</h3>
                    <button class="btn btn-success" onclick="app.runAllTests()">è¿è¡Œå…¨éƒ¨æµ‹è¯•</button>
                    <button class="btn btn-primary" onclick="app.testHealth()">å¥åº·æ£€æŸ¥</button>
                    <button class="btn btn-primary" onclick="app.testAuth()">æµ‹è¯•è®¤è¯</button>
                    <button class="btn btn-primary" onclick="app.testPosts()">æµ‹è¯•æ–‡ç« </button>
                    <button class="btn btn-primary" onclick="app.testComments()">æµ‹è¯•è¯„è®º</button>
                    <button class="btn btn-danger" onclick="app.clearTestResults()">æ¸…é™¤ç»“æœ</button>
                </div>

                <div class="test-results" id="testResults">
                    <p style="color: #6c757d;">æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        var app = {
            apiBase: 'http://localhost:8080/api/v1',
            token: localStorage.getItem('token') || '',
            user: null,
            currentPost: null,

            init: function () {
                this.loadConfig();
                this.bindEvents();
                if (this.token) {
                    this.fetchProfile();
                }
                this.fetchPosts();
            },

            loadConfig: function () {
                var saved = localStorage.getItem('apiBase');
                if (saved) {
                    this.apiBase = saved;
                    document.getElementById('apiBaseUrl').value = saved;
                }
            },

            saveConfig: function () {
                this.apiBase = document.getElementById('apiBaseUrl').value;
                localStorage.setItem('apiBase', this.apiBase);
                this.showAlert('success', 'é…ç½®å·²ä¿å­˜');
            },

            bindEvents: function () {
                var self = this;

                document.querySelectorAll('.nav-tab').forEach(function (tab) {
                    tab.addEventListener('click', function (e) {
                        var page = e.target.dataset.page;
                        self.showPage(page);
                    });
                });

                document.getElementById('loginForm').addEventListener('submit', function (e) {
                    e.preventDefault();
                    self.handleLogin();
                });

                document.getElementById('registerForm').addEventListener('submit', function (e) {
                    e.preventDefault();
                    self.handleRegister();
                });

                document.getElementById('createPostForm').addEventListener('submit', function (e) {
                    e.preventDefault();
                    self.handleCreatePost();
                });

                document.getElementById('editPostForm').addEventListener('submit', function (e) {
                    e.preventDefault();
                    self.handleUpdatePost();
                });

                document.getElementById('commentForm').addEventListener('submit', function (e) {
                    e.preventDefault();
                    self.handleCreateComment();
                });

                document.getElementById('logoutBtn').addEventListener('click', function () {
                    self.handleLogout();
                });
            },

            showPage: function (page) {
                var self = this;
                document.querySelectorAll('.page').forEach(function (p) {
                    p.classList.add('hidden');
                });
                document.querySelectorAll('.nav-tab').forEach(function (t) {
                    t.classList.remove('active');
                });

                var pageMap = {
                    'home': 'homePage',
                    'login': 'loginPage',
                    'register': 'registerPage',
                    'myPosts': 'myPostsPage',
                    'createPost': 'createPostPage',
                    'test': 'testPage'
                };

                var pageId = pageMap[page];
                if (pageId) {
                    document.getElementById(pageId).classList.remove('hidden');
                    var tab = document.querySelector('[data-page="' + page + '"]');
                    if (tab) tab.classList.add('active');
                }

                if (page === 'myPosts') {
                    this.fetchMyPosts();
                } else if (page === 'home') {
                    this.fetchPosts();
                }
            },

            showAlert: function (type, message) {
                var alert = document.getElementById('alertBox');
                alert.className = 'alert alert-' + type + ' show';
                alert.textContent = message;
                setTimeout(function () {
                    alert.classList.remove('show');
                }, 5000);
            },

            updateUserDisplay: function () {
                var display = document.getElementById('userDisplay');
                var logoutBtn = document.getElementById('logoutBtn');

                if (this.user) {
                    display.textContent = 'ğŸ‘¤ ' + this.user.username;
                    logoutBtn.classList.remove('hidden');
                } else {
                    display.textContent = '';
                    logoutBtn.classList.add('hidden');
                }
            },

            fetchProfile: function () {
                var self = this;
                fetch(this.apiBase + '/profile', {
                    headers: { 'Authorization': 'Bearer ' + this.token }
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.user = data.data;
                            self.updateUserDisplay();
                        } else {
                            self.handleLogout();
                        }
                    })
                    .catch(function (err) {
                        console.error('Fetch profile error:', err);
                    });
            },

            handleLogin: function () {
                var self = this;
                var username = document.getElementById('loginUsername').value;
                var password = document.getElementById('loginPassword').value;

                fetch(this.apiBase + '/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: username, password: password })
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.token = data.data.token;
                            localStorage.setItem('token', self.token);
                            self.fetchProfile();
                            self.showAlert('success', 'ç™»å½•æˆåŠŸï¼');
                            self.showPage('home');
                            document.getElementById('loginForm').reset();
                        } else {
                            self.showAlert('error', data.message || 'ç™»å½•å¤±è´¥');
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'ç™»å½•è¯·æ±‚å¤±è´¥');
                    });
            },

            handleRegister: function () {
                var self = this;
                var username = document.getElementById('regUsername').value;
                var email = document.getElementById('regEmail').value;
                var password = document.getElementById('regPassword').value;

                fetch(this.apiBase + '/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: username, email: email, password: password })
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.showAlert('success', 'æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•');
                            self.showPage('login');
                            document.getElementById('registerForm').reset();
                        } else {
                            self.showAlert('error', data.message || 'æ³¨å†Œå¤±è´¥');
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'æ³¨å†Œè¯·æ±‚å¤±è´¥');
                    });
            },

            handleLogout: function () {
                this.token = '';
                this.user = null;
                localStorage.removeItem('token');
                this.updateUserDisplay();
                this.showAlert('success', 'å·²é€€å‡ºç™»å½•');
                this.showPage('home');
            },

            fetchPosts: function () {
                var self = this;
                fetch(this.apiBase + '/posts')
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.renderPosts(data.data.posts || [], 'postsList');
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'è·å–æ–‡ç« åˆ—è¡¨å¤±è´¥');
                    });
            },

            fetchMyPosts: function () {
                var self = this;
                if (!this.token) {
                    this.showAlert('error', 'è¯·å…ˆç™»å½•');
                    return;
                }

                fetch(this.apiBase + '/posts', {
                    headers: { 'Authorization': 'Bearer ' + this.token }
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            var myPosts = (data.data.posts || []).filter(function (post) {
                                return post.user_id === self.user.id;
                            });
                            self.renderPosts(myPosts, 'myPostsList', true);
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'è·å–æˆ‘çš„æ–‡ç« å¤±è´¥');
                    });
            },

            renderPosts: function (posts, containerId, showActions) {
                var self = this;
                var container = document.getElementById(containerId);

                if (!posts || posts.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div style="font-size: 48px;">ğŸ“­</div><p>æš‚æ— æ–‡ç« </p></div>';
                    return;
                }

                container.innerHTML = posts.map(function (post) {
                    var actions = '';
                    if (showActions && self.user && post.user_id === self.user.id) {
                        actions = '<div class="post-actions">' +
                            '<button class="btn btn-primary btn-small" onclick="app.editPost(' + post.ID + ')">âœï¸ ç¼–è¾‘</button>' +
                            '<button class="btn btn-danger btn-small" onclick="app.deletePost(' + post.ID + ')">ğŸ—‘ï¸ åˆ é™¤</button>' +
                            '</div>';
                    }

                    return '<div class="post-card">' +
                        '<h3 onclick="app.viewPost(' + post.ID + ')">' + post.title + '</h3>' +
                        '<div class="post-meta">ğŸ‘¤ ' + (post.user ? post.user.username : 'æœªçŸ¥') + ' | ğŸ“… ' + new Date(post.CreatedAt).toLocaleString('zh-CN') + '</div>' +
                        '<div class="post-content">' + post.content.substring(0, 150) + (post.content.length > 150 ? '...' : '') + '</div>' +
                        actions +
                        '</div>';
                }).join('');
            },

            viewPost: function (id) {
                var self = this;
                fetch(this.apiBase + '/posts/' + id)
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.currentPost = data.data;
                            self.renderPostDetail(data.data);
                            self.fetchComments(id);

                            document.querySelectorAll('.page').forEach(function (p) {
                                p.classList.add('hidden');
                            });
                            document.getElementById('postDetailPage').classList.remove('hidden');
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'è·å–æ–‡ç« è¯¦æƒ…å¤±è´¥');
                    });
            },

            renderPostDetail: function (post) {
                var container = document.getElementById('postDetail');
                container.innerHTML = '<h2 style="margin-bottom: 15px;">' + post.title + '</h2>' +
                    '<div class="post-meta" style="margin-bottom: 25px;">ğŸ‘¤ ' + (post.user ? post.user.username : 'æœªçŸ¥') + ' | ğŸ“… ' + new Date(post.CreatedAt).toLocaleString('zh-CN') + '</div>' +
                    '<div class="post-content" style="line-height: 1.8; white-space: pre-wrap;">' + post.content + '</div>';

                var commentForm = document.getElementById('commentForm');
                if (this.token) {
                    commentForm.classList.remove('hidden');
                } else {
                    commentForm.classList.add('hidden');
                }
            },

            fetchComments: function (postId) {
                var self = this;
                fetch(this.apiBase + '/comments/post/' + postId)
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.renderComments(data.data || []);
                        }
                    })
                    .catch(function (err) {
                        console.error('Fetch comments error:', err);
                    });
            },

            renderComments: function (comments) {
                var container = document.getElementById('commentsList');

                if (!comments || comments.length === 0) {
                    container.innerHTML = '<p style="color: #6c757d; text-align: center;">æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼</p>';
                    return;
                }

                container.innerHTML = comments.map(function (comment) {
                    return '<div class="comment-card">' +
                        '<div class="comment-meta">ğŸ‘¤ ' + (comment.user ? comment.user.username : 'æœªçŸ¥') + ' | ' + new Date(comment.CreatedAt).toLocaleString('zh-CN') + '</div>' +
                        '<div class="comment-content">' + comment.content + '</div>' +
                        '</div>';
                }).join('');
            },

            handleCreatePost: function () {
                var self = this;
                if (!this.token) {
                    this.showAlert('error', 'è¯·å…ˆç™»å½•');
                    return;
                }

                var title = document.getElementById('postTitle').value;
                var content = document.getElementById('postContent').value;

                fetch(this.apiBase + '/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + this.token
                    },
                    body: JSON.stringify({ title: title, content: content })
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.showAlert('success', 'æ–‡ç« å‘å¸ƒæˆåŠŸï¼');
                            document.getElementById('createPostForm').reset();
                            self.showPage('myPosts');
                        } else {
                            self.showAlert('error', data.message || 'å‘å¸ƒå¤±è´¥');
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'å‘å¸ƒè¯·æ±‚å¤±è´¥');
                    });
            },

            editPost: function (id) {
                var self = this;
                fetch(this.apiBase + '/posts/' + id)
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            document.getElementById('editPostId').value = data.data.ID;
                            document.getElementById('editPostTitle').value = data.data.title;
                            document.getElementById('editPostContent').value = data.data.content;

                            document.querySelectorAll('.page').forEach(function (p) {
                                p.classList.add('hidden');
                            });
                            document.getElementById('editPostPage').classList.remove('hidden');
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'è·å–æ–‡ç« ä¿¡æ¯å¤±è´¥');
                    });
            },

            handleUpdatePost: function () {
                var self = this;
                var id = document.getElementById('editPostId').value;
                var title = document.getElementById('editPostTitle').value;
                var content = document.getElementById('editPostContent').value;
                fetch(this.apiBase + '/posts/' + id, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + this.token
                    },
                    body: JSON.stringify({ title: title, content: content })
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.showAlert('success', 'æ–‡ç« æ›´æ–°æˆåŠŸï¼');
                            self.showPage('myPosts');
                        } else {
                            self.showAlert('error', data.message || 'æ›´æ–°å¤±è´¥');
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'æ›´æ–°è¯·æ±‚å¤±è´¥');
                    });
            },

            deletePost: function (id) {
                var self = this;
                if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿ')) return;

                fetch(this.apiBase + '/posts/' + id, {
                    method: 'DELETE',
                    headers: { 'Authorization': 'Bearer ' + this.token }
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.showAlert('success', 'æ–‡ç« åˆ é™¤æˆåŠŸï¼');
                            self.fetchMyPosts();
                        } else {
                            self.showAlert('error', data.message || 'åˆ é™¤å¤±è´¥');
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'åˆ é™¤è¯·æ±‚å¤±è´¥');
                    });
            },

            handleCreateComment: function () {
                var self = this;
                if (!this.token) {
                    this.showAlert('error', 'è¯·å…ˆç™»å½•');
                    return;
                }

                var content = document.getElementById('commentContent').value;
                var postId = this.currentPost.ID;

                fetch(this.apiBase + '/posts/' + postId + '/comments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + this.token
                    },
                    body: JSON.stringify({ content: content })
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.code === 200) {
                            self.showAlert('success', 'è¯„è®ºå‘è¡¨æˆåŠŸï¼');
                            document.getElementById('commentContent').value = '';
                            self.fetchComments(postId);
                        } else {
                            self.showAlert('error', data.message || 'è¯„è®ºå¤±è´¥');
                        }
                    })
                    .catch(function (err) {
                        self.showAlert('error', 'è¯„è®ºè¯·æ±‚å¤±è´¥');
                    });
            },

            addTestResult: function (message, success) {
                var results = document.getElementById('testResults');
                var div = document.createElement('div');
                div.className = 'test-item test-' + (success ? 'success' : 'error');
                div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
                results.insertBefore(div, results.firstChild);
            },

            clearTestResults: function () {
                document.getElementById('testResults').innerHTML = '<p style="color: #6c757d;">æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>';
            },

            testHealth: function () {
                var self = this;
                this.addTestResult('å¼€å§‹å¥åº·æ£€æŸ¥æµ‹è¯•...', true);

                fetch('http://localhost:8080/health')
                    .then(function (res) {
                        if (res.ok) {
                            self.addTestResult('âœ“ å¥åº·æ£€æŸ¥é€šè¿‡', true);
                        } else {
                            self.addTestResult('âœ— å¥åº·æ£€æŸ¥å¤±è´¥', false);
                        }
                    })
                    .catch(function (err) {
                        self.addTestResult('âœ— å¥åº·æ£€æŸ¥é”™è¯¯: ' + err.message, false);
                    });
            },

            testAuth: function () {
                var self = this;
                this.addTestResult('å¼€å§‹è®¤è¯æµ‹è¯•...', true);

                var testUser = {
                    username: 'test_' + Date.now(),
                    email: 'test_' + Date.now() + '@example.com',
                    password: 'test123456'
                };

                fetch(this.apiBase + '/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testUser)
                })
                    .then(function (res) { return res.json(); })
                    .then(function (regData) {
                        if (regData.code === 200) {
                            self.addTestResult('âœ“ æ³¨å†Œæµ‹è¯•é€šè¿‡', true);

                            return fetch(self.apiBase + '/auth/login', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    username: testUser.username,
                                    password: testUser.password
                                })
                            });
                        } else {
                            self.addTestResult('âœ— æ³¨å†Œæµ‹è¯•å¤±è´¥', false);
                            throw new Error('Registration failed');
                        }
                    })
                    .then(function (res) { return res.json(); })
                    .then(function (loginData) {
                        if (loginData.code === 200 && loginData.data.token) {
                            self.addTestResult('âœ“ ç™»å½•æµ‹è¯•é€šè¿‡', true);

                            return fetch(self.apiBase + '/profile', {
                                headers: { 'Authorization': 'Bearer ' + loginData.data.token }
                            });
                        } else {
                            self.addTestResult('âœ— ç™»å½•æµ‹è¯•å¤±è´¥', false);
                            throw new Error('Login failed');
                        }
                    })
                    .then(function (res) { return res.json(); })
                    .then(function (profileData) {
                        if (profileData.code === 200) {
                            self.addTestResult('âœ“ è·å–ç”¨æˆ·ä¿¡æ¯æµ‹è¯•é€šè¿‡', true);
                        } else {
                            self.addTestResult('âœ— è·å–ç”¨æˆ·ä¿¡æ¯æµ‹è¯•å¤±è´¥', false);
                        }
                    })
                    .catch(function (err) {
                        self.addTestResult('âœ— è®¤è¯æµ‹è¯•é”™è¯¯: ' + err.message, false);
                    });
            },

            testPosts: function () {
                var self = this;
                if (!this.token) {
                    this.addTestResult('âœ— è¯·å…ˆç™»å½•åå†æµ‹è¯•æ–‡ç« åŠŸèƒ½', false);
                    return;
                }

                this.addTestResult('å¼€å§‹æ–‡ç« æµ‹è¯•...', true);

                var postData = {
                    title: 'æµ‹è¯•æ–‡ç«  ' + Date.now(),
                    content: 'è¿™æ˜¯ä¸€ç¯‡æµ‹è¯•æ–‡ç« çš„å†…å®¹'
                };

                var postId;

                fetch(this.apiBase + '/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + this.token
                    },
                    body: JSON.stringify(postData)
                })
                    .then(function (res) { return res.json(); })
                    .then(function (createData) {
                        if (createData.code === 200) {
                            self.addTestResult('âœ“ åˆ›å»ºæ–‡ç« æµ‹è¯•é€šè¿‡', true);
                            postId = createData.data.ID;

                            return fetch(self.apiBase + '/posts/' + postId);
                        } else {
                            self.addTestResult('âœ— åˆ›å»ºæ–‡ç« æµ‹è¯•å¤±è´¥', false);
                            throw new Error('Create post failed');
                        }
                    })
                    .then(function (res) { return res.json(); })
                    .then(function (getData) {
                        if (getData.code === 200) {
                            self.addTestResult('âœ“ è·å–æ–‡ç« è¯¦æƒ…æµ‹è¯•é€šè¿‡', true);

                            return fetch(self.apiBase + '/posts/' + postId, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer ' + self.token
                                },
                                body: JSON.stringify({
                                    title: 'æ›´æ–°åçš„æ ‡é¢˜',
                                    content: 'æ›´æ–°åçš„å†…å®¹'
                                })
                            });
                        } else {
                            self.addTestResult('âœ— è·å–æ–‡ç« è¯¦æƒ…æµ‹è¯•å¤±è´¥', false);
                            throw new Error('Get post failed');
                        }
                    })
                    .then(function (res) { return res.json(); })
                    .then(function (updateData) {
                        if (updateData.code === 200) {
                            self.addTestResult('âœ“ æ›´æ–°æ–‡ç« æµ‹è¯•é€šè¿‡', true);

                            return fetch(self.apiBase + '/posts/' + postId, {
                                method: 'DELETE',
                                headers: { 'Authorization': 'Bearer ' + self.token }
                            });
                        } else {
                            self.addTestResult('âœ— æ›´æ–°æ–‡ç« æµ‹è¯•å¤±è´¥', false);
                            throw new Error('Update post failed');
                        }
                    })
                    .then(function (res) { return res.json(); })
                    .then(function (deleteData) {
                        if (deleteData.code === 200) {
                            self.addTestResult('âœ“ åˆ é™¤æ–‡ç« æµ‹è¯•é€šè¿‡', true);
                        } else {
                            self.addTestResult('âœ— åˆ é™¤æ–‡ç« æµ‹è¯•å¤±è´¥', false);
                        }

                        return fetch(self.apiBase + '/posts');
                    })
                    .then(function (res) { return res.json(); })
                    .then(function (listData) {
                        if (listData.code === 200) {
                            self.addTestResult('âœ“ è·å–æ–‡ç« åˆ—è¡¨æµ‹è¯•é€šè¿‡', true);
                        } else {
                            self.addTestResult('âœ— è·å–æ–‡ç« åˆ—è¡¨æµ‹è¯•å¤±è´¥', false);
                        }
                    })
                    .catch(function (err) {
                        self.addTestResult('âœ— æ–‡ç« æµ‹è¯•é”™è¯¯: ' + err.message, false);
                    });
            },

            testComments: function () {
                var self = this;
                if (!this.token) {
                    this.addTestResult('âœ— è¯·å…ˆç™»å½•åå†æµ‹è¯•è¯„è®ºåŠŸèƒ½', false);
                    return;
                }

                this.addTestResult('å¼€å§‹è¯„è®ºæµ‹è¯•...', true);

                var postId;

                fetch(this.apiBase + '/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + this.token
                    },
                    body: JSON.stringify({
                        title: 'æµ‹è¯•è¯„è®ºæ–‡ç« ',
                        content: 'ç”¨äºæµ‹è¯•è¯„è®ºåŠŸèƒ½'
                    })
                })
                    .then(function (res) { return res.json(); })
                    .then(function (postData) {
                        if (postData.code === 200) {
                            postId = postData.data.ID;

                            return fetch(self.apiBase + '/posts/' + postId + '/comments', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer ' + self.token
                                },
                                body: JSON.stringify({
                                    content: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•è¯„è®º'
                                })
                            });
                        } else {
                            throw new Error('Create post for comments failed');
                        }
                    })
                    .then(function (res) { return res.json(); })
                    .then(function (commentData) {
                        if (commentData.code === 200) {
                            self.addTestResult('âœ“ åˆ›å»ºè¯„è®ºæµ‹è¯•é€šè¿‡', true);

                            return fetch(self.apiBase + '/comments/post/' + postId);
                        } else {
                            self.addTestResult('âœ— åˆ›å»ºè¯„è®ºæµ‹è¯•å¤±è´¥', false);
                            throw new Error('Create comment failed');
                        }
                    })
                    .then(function (res) { return res.json(); })
                    .then(function (getCommentsData) {
                        if (getCommentsData.code === 200) {
                            self.addTestResult('âœ“ è·å–è¯„è®ºåˆ—è¡¨æµ‹è¯•é€šè¿‡', true);
                        } else {
                            self.addTestResult('âœ— è·å–è¯„è®ºåˆ—è¡¨æµ‹è¯•å¤±è´¥', false);
                        }

                        return fetch(self.apiBase + '/posts/' + postId, {
                            method: 'DELETE',
                            headers: { 'Authorization': 'Bearer ' + self.token }
                        });
                    })
                    .then(function () {
                        // Cleanup done
                    })
                    .catch(function (err) {
                        self.addTestResult('âœ— è¯„è®ºæµ‹è¯•é”™è¯¯: ' + err.message, false);
                    });
            },

            runAllTests: function () {
                var self = this;
                this.clearTestResults();
                this.addTestResult('=== å¼€å§‹è¿è¡Œå…¨éƒ¨æµ‹è¯• ===', true);

                this.testHealth();

                setTimeout(function () {
                    self.testAuth();
                }, 1000);

                setTimeout(function () {
                    self.testPosts();
                }, 2000);

                setTimeout(function () {
                    self.testComments();
                }, 3000);

                setTimeout(function () {
                    self.addTestResult('=== å…¨éƒ¨æµ‹è¯•å®Œæˆ ===', true);
                }, 5000);
            }
        };

        document.addEventListener('DOMContentLoaded', function () {
            app.init();
        });
    </script>
</body>

</html>